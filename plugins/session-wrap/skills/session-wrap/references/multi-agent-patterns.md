# Multi-Agent Orchestration Patterns

세션 분석을 위한 멀티에이전트 오케스트레이션 패턴 가이드.

## Parallel vs Sequential 결정 기준

### Parallel 실행이 적합한 경우
- 각 에이전트가 **독립적인 관점**으로 분석할 때
- 에이전트 간 **데이터 의존성이 없을** 때
- **시간 단축**이 중요할 때

### Sequential 실행이 적합한 경우
- 이전 에이전트의 **출력이 다음 에이전트의 입력**일 때
- **검증/리뷰** 단계가 필요할 때
- 순서가 결과 품질에 영향을 줄 때

## Anthropic의 6가지 Composable 패턴

[Building Effective Agents](https://www.anthropic.com/research/building-effective-agents) 참고:

1. **Prompt Chaining**: 순차적 처리, 각 단계가 다음 단계에 입력 제공
2. **Routing**: 입력 분류 후 적절한 에이전트로 라우팅
3. **Parallelization**: 독립적인 작업을 동시에 처리
4. **Orchestrator-Workers**: 중앙 오케스트레이터가 작업 분배
5. **Evaluator-Optimizer**: 생성-평가 반복 루프
6. **Autonomous Agent**: 자율적 판단과 도구 사용

## 2-Phase Pipeline 패턴

session-wrap에서 사용하는 패턴:

```
┌─────────────────────────────────────────────────────────┐
│                      Phase 1: Analysis                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │ doc-updater  │  │ automation-  │  │  learning-   │   │
│  │              │  │    scout     │  │  extractor   │   │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘   │
│         │                 │                 │           │
│  ┌──────┴─────────────────┴─────────────────┴───────┐   │
│  │              followup-suggester                   │   │
│  └──────────────────────┬───────────────────────────┘   │
│                         │                               │
└─────────────────────────┼───────────────────────────────┘
                          ▼
┌─────────────────────────────────────────────────────────┐
│                   Phase 2: Validation                    │
│  ┌──────────────────────────────────────────────────┐   │
│  │              duplicate-checker                    │   │
│  │   (중복 검증, 충돌 해결, 우선순위 조정)            │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
```

### Phase 1: Parallel Analysis
- 4개 에이전트가 **동시에** 세션 분석
- 각자의 관점에서 독립적으로 인사이트 추출
- Task 도구로 병렬 실행

### Phase 2: Sequential Validation
- Phase 1 결과를 **통합 검증**
- 중복 제거, 충돌 해결
- 최종 출력 품질 보장

## Claude Code에서 구현 방법

### Task 도구 병렬 호출
```markdown
Phase 1에서는 Task 도구를 **단일 메시지에 여러 번** 호출하여 병렬 실행:

1. doc-updater 에이전트 실행 (Task)
2. automation-scout 에이전트 실행 (Task)
3. learning-extractor 에이전트 실행 (Task)
4. followup-suggester 에이전트 실행 (Task)

→ 4개 모두 동시에 실행됨
```

### 에이전트 정의
각 에이전트는 `agents/*.md` 파일로 정의:
- **System prompt**: 역할과 분석 관점
- **Output format**: 구조화된 결과 형식
- **Scope**: 분석 범위 제한

### 결과 집계
Phase 2 에이전트가 모든 결과를 받아 통합:
- 중복 항목 병합
- 충돌하는 제안 해결
- 우선순위 기반 정렬

## Best Practices

1. **에이전트 역할 명확히**: 각 에이전트의 책임 범위를 분명히 정의
2. **출력 형식 표준화**: 결과 집계를 위해 일관된 형식 사용
3. **실패 처리**: 개별 에이전트 실패가 전체에 영향 안 주도록
4. **컨텍스트 최소화**: 각 에이전트에 필요한 정보만 전달
5. **검증 단계 필수**: 병렬 처리 후 반드시 검증 단계 추가
